@startuml CookSync_Component_Diagram
!define RECTANGLE class

title Diagrama de Componentes - Sistema CookSync

' ===== FRONTEND LAYER =====
package "Frontend (React - Puerto 3001)" {
  
  ' Core Components
  component [App.js] as App
  component [AuthContext] as AuthCtx
  component [NotificationContext] as NotifCtx
  component [ProtectedRoute] as ProtectedR
  
  ' Authentication Components
  package "Auth Components" {
    component [Login] as LoginComp
    component [Register] as RegisterComp
    component [AuthRedirect] as AuthRedir
  }
  
  ' Main Pages
  package "Main Pages" {
    component [HomePage] as HomeP
    component [RecipeDetail] as RecipeDetailP
    component [FavoritesPage] as FavoritesP
    component [ProductsPage] as ProductsP
    component [CategoriesPage] as CategoriesP
  }
  
  ' Dashboard Components by Role
  package "Dashboard Components" {
    component [ClientProfile] as ClientDash
    component [VendorProfile] as VendorDash
    component [AdminProfile] as AdminDash
    component [ModeratorProfile] as ModeratorDash
  }
  
  ' Recipe Components
  package "Recipe Components" {
    component [RecipeSearch] as RecipeSearchComp
    component [RecipeGrid] as RecipeGridComp
    component [RecipeCard] as RecipeCardComp
    component [RecipeFilters] as RecipeFiltersComp
  }
  
  ' Pantry Components
  package "Pantry Components" {
    component [PantryManager] as PantryMgr
    component [IngredientSelector] as IngredientSel
  }
  
  ' Services Layer
  package "Frontend Services" {
    component [recipeService.js] as RecipeService
    component [adminService.js] as AdminService
    component [favoritesService.js] as FavoritesService
    component [productService.js] as ProductService
    component [searchService.js] as SearchService
  }
  
  ' Configuration
  component [API_CONFIG] as APIConfig
}

' ===== BACKEND LAYER =====
package "Backend (NestJS - Puerto 3002)" {
  
  ' Core Module
  component [AppModule] as AppMod
  component [AppController] as AppCtrl
  component [AppService] as AppSvc
  
  ' Security Layer
  package "Security & Middleware" {
    component [SecurityMiddleware] as SecMid
    component [JwtAuthGuard] as JwtGuard
    component [RolesGuard] as RolesGuard
    component [RolesDecorator] as RolesDec
  }
  
  ' Authentication Module
  package "Auth Module" {
    component [AuthModule] as AuthMod
    component [AuthController] as AuthCtrl
    component [AuthService] as AuthSvc
    component [AuthPrismaService] as AuthPrismaS
  }
  
  ' Recipes Module
  package "Recipes Module" {
    component [RecipesModule] as RecipesMod
    component [RecipesController] as RecipesCtrl
    component [RecipesService] as RecipesSvc
    component [RecipesPrismaService] as RecipesPrismaS
  }
  
  ' Admin Module
  package "Admin Module" {
    component [AdminModule] as AdminMod
    component [AdminController] as AdminCtrl
    component [AdminService] as AdminSvc
  }
  
  ' Clients Module
  package "Clients Module" {
    component [ClientsModule] as ClientsMod
    component [ClientsController] as ClientsCtrl
    component [ClientsService] as ClientsSvc
  }
  
  ' Products Module
  package "Products Module" {
    component [ProductsModule] as ProductsMod
    component [ProductsController] as ProductsCtrl
    component [ProductsService] as ProductsSvc
  }
  
  ' Search Module
  package "Search Module" {
    component [SearchModule] as SearchMod
    component [SearchController] as SearchCtrl
    component [SearchService] as SearchSvc
  }
}

' ===== DATA LAYER =====
package "Data Layer" {
  
  ' Prisma ORM
  package "Prisma ORM" {
    component [PrismaModule] as PrismaMod
    component [PrismaService] as PrismaSvc
    component [PrismaClient] as PrismaClient
  }
  
  ' TypeORM (Legacy)
  package "TypeORM (Legacy)" {
    component [TypeOrmModule] as TypeOrmMod
    component [TypeOrmConfig] as TypeOrmConf
  }
  
  ' Database
  database "MySQL Database" {
    component [Users Table] as UsersTable
    component [Recipes Table] as RecipesTable
    component [Ingredients Table] as IngredientsTable
    component [Favorites Table] as FavoritesTable
    component [Roles Table] as RolesTable
    component [Categories Table] as CategoriesTable
    component [UserPantry Table] as PantryTable
  }
}

' ===== EXTERNAL SERVICES =====
cloud "External Services" {
  component [JWT Token Service] as JWTService
  component [File Upload Service] as FileService
  component [Email Service] as EmailService
}

' ===== RELATIONSHIPS =====

' Frontend Internal Relationships
App --> AuthCtx
App --> NotifCtx
App --> ProtectedR
App --> HomeP
App --> RecipeDetailP
App --> FavoritesP
App --> ProductsP
App --> CategoriesP

HomeP --> RecipeSearchComp
HomeP --> RecipeGridComp
RecipeGridComp --> RecipeCardComp
RecipeSearchComp --> RecipeFiltersComp
RecipeSearchComp --> IngredientSel

ClientDash --> PantryMgr
PantryMgr --> IngredientSel

' Frontend to Services
HomeP --> RecipeService
RecipeDetailP --> RecipeService
FavoritesP --> FavoritesService
AdminDash --> AdminService
ProductsP --> ProductService

RecipeService --> APIConfig
AdminService --> APIConfig
FavoritesService --> APIConfig
ProductService --> APIConfig
SearchService --> APIConfig

' Frontend to Backend (HTTP/REST)
RecipeService ..> RecipesCtrl : HTTP REST API
AdminService ..> AdminCtrl : HTTP REST API
FavoritesService ..> RecipesCtrl : HTTP REST API
ProductService ..> ProductsCtrl : HTTP REST API
AuthCtx ..> AuthCtrl : HTTP REST API

' Backend Internal Relationships
AppMod --> AuthMod
AppMod --> RecipesMod
AppMod --> AdminMod
AppMod --> ClientsMod
AppMod --> ProductsMod
AppMod --> PrismaMod
AppMod --> TypeOrmMod
AppMod --> SecMid

AuthMod --> AuthCtrl
AuthMod --> AuthSvc
AuthMod --> AuthPrismaS
AuthCtrl --> JwtGuard
AdminCtrl --> RolesGuard
AdminCtrl --> RolesDec

RecipesMod --> RecipesCtrl
RecipesMod --> RecipesSvc
RecipesMod --> RecipesPrismaS

AdminMod --> AdminCtrl
AdminMod --> AdminSvc

ClientsMod --> ClientsCtrl
ClientsMod --> ClientsSvc

ProductsMod --> ProductsCtrl
ProductsMod --> ProductsSvc

' Backend to Data Layer
AuthPrismaS --> PrismaSvc
RecipesPrismaS --> PrismaSvc
PrismaSvc --> PrismaClient
AdminSvc --> TypeOrmConf

' Data Layer to Database
PrismaClient --> UsersTable
PrismaClient --> RecipesTable
PrismaClient --> IngredientsTable
PrismaClient --> FavoritesTable
PrismaClient --> RolesTable
PrismaClient --> CategoriesTable
PrismaClient --> PantryTable

TypeOrmConf --> UsersTable
TypeOrmConf --> RecipesTable
TypeOrmConf --> RolesTable

' External Services
AuthSvc --> JWTService
RecipesSvc --> FileService
AdminSvc --> EmailService

' ===== NOTES =====
note right of RecipeService
  Maneja:
  - Búsqueda por ingredientes
  - Filtros avanzados
  - Recomendaciones inteligentes
  - CRUD de recetas
end note

note right of AuthSvc
  Funcionalidades:
  - JWT Authentication
  - Role-based Access Control
  - Password Hashing
  - User Registration/Login
end note

note right of RecipesPrismaS
  Algoritmos implementados:
  - Búsqueda por ingredientes
  - Sistema de recomendaciones
  - Cálculo de coincidencias
  - Filtros combinados
end note

note right of PrismaSvc
  Base de datos:
  - 15+ tablas relacionadas
  - 45+ recetas peruanas
  - Datos de ingredientes
  - Sistema de usuarios completo
end note

note bottom of APIConfig
  Configuración centralizada:
  - Base URL: localhost:3002
  - Headers de autenticación
  - Timeouts y fallbacks
  - Logging consistente
end note

@enduml
